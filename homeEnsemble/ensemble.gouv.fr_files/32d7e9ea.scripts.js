"use strict";var ddsApp=angular.module("ddsApp",["ui.router","ngAnimate","ui.bootstrap","ngStorage","ddsCommon","ngSanitize"]);ddsApp.config(["$locationProvider","$stateProvider","$urlRouterProvider","$uiViewScrollProvider",function(a,b,c,d){moment.lang("fr");var e=(new Date).getFullYear()-2e3;moment.parseTwoDigitYear=function(a){return a=parseInt(a),a+(e>=a?2e3:1900)},a.html5Mode(!0),c.otherwise("/"),d.useAnchorScroll();var f=function(a,b){return{templateUrl:"/partials/foyer/individu-form.html",controller:"FoyerIndividuFormCtrl",resolve:{options:function(){return{individuRole:a,captureRelationConjoint:"conjoint"===a,capturePrenom:b||!1,checkResidenceStability:_.contains(["demandeur","conjoint"],a)}}}}};b.state("home",{url:"/",templateUrl:"/partials/homepage.html",controller:"HomepageCtrl"}).state("a_propos",{url:"/a-propos",templateUrl:"/partials/a-propos.html",data:{pageTitle:"A propos - "}}).state("cgu",{url:"/conditions-generales-d-utilisation",templateUrl:"/partials/cgu.html",data:{pageTitle:"Conditions générales d'utilisation - "}}).state("contribuez",{url:"/contribuez",templateUrl:"/partials/contribuez.html",controller:"ContribuezCtrl",data:{pageTitle:"Contribuez ! - "}}).state("faq",{url:"/faq",templateUrl:"/partials/faq.html",data:{pageTitle:"FAQ - "}}).state("tests",{url:"/tests",onEnter:["$window",function(a){a.location.href="/tests"}]}).state("foyer",{"abstract":!0,url:"/foyer",views:{"":{controller:"FoyerCtrl",templateUrl:"/partials/foyer/layout.html"},"recap_situation@foyer":{controller:"RecapSituationCtrl",templateUrl:"/partials/foyer/recap-situation.html"}},data:{pageTitle:"Simulation - "}}).state("foyer.demandeur",{url:"/demandeur",views:{"":{templateUrl:"/partials/foyer/demandeur.html"},"individuForm@foyer.demandeur":f("demandeur")}}).state("foyer.conjoint",{url:"/conjoint",views:{"":{templateUrl:"/partials/foyer/conjoint.html",controller:"FoyerConjointCtrl"},"individuForm@foyer.conjoint":f("conjoint")}}).state("foyer.personnesACharge",{url:"/personnes-a-charge",views:{"":{templateUrl:"/partials/foyer/personnes-a-charge.html",controller:"FoyerPersonnesAChargeCtrl"},"enfantForm@foyer.personnesACharge":f("enfant",!0),"parentProcheForm@foyer.personnesACharge":f("parentProche",!0)}}).state("foyer.logement",{url:"/logement",templateUrl:"/partials/foyer/logement.html",controller:"FoyerLogementCtrl"}).state("foyer.ressources",{url:"/ressources",controller:"FoyerRessourcesCtrl",templateUrl:"/partials/foyer/ressources/layout.html"}).state("foyer.ressources.types",{templateUrl:"/partials/foyer/ressources/types.html",controller:"FoyerRessourceTypesCtrl",url:"/:individu/types"}).state("foyer.pensionsAlimentaires",{templateUrl:"/partials/foyer/pensions-alimentaires.html",controller:"FoyerPensionsAlimentairesCtrl",url:"/ressources/pensions-alimentaires"}).state("foyer.simulation",{url:"/simulation",templateUrl:"/partials/simulation.html",controller:"SimulationCtrl"}).state("foyer.ressourcesYearMoins2",{templateUrl:"/partials/foyer/ressources/year-moins-2.html",controller:"FoyerRessourceYearMoins2Ctrl",url:"/ressources/revenus-impots"}).state("foyer.rfr",{templateUrl:"/partials/foyer/ressources/rfr.html",controller:"FoyerRessourceRfrCtrl",url:"/ressources/rfr"}).state("foyer.patrimoine",{url:"/patrimoine",templateUrl:"/partials/foyer/patrimoine.html",controller:"FoyerPatrimoineCtrl"}).state("situation",{url:"/situations/:situationId",template:"",controller:["SituationService","$state","$stateParams",function(a,b,c){a.restoreRemote(c.situationId).then(function(){b.go("foyer.simulation",{situationId:c.situationId})})}]}).state("infos_complementaires",{"abstract":!0,url:"/infos-complementaires",templateUrl:"/partials/form-infos-complementaires/layout.html",data:{pageTitle:"Informations complémentaires - "}}).state("infos_complementaires.individus",{url:"/noms-prenoms?droit",templateUrl:"/partials/form-infos-complementaires/individus.html",controller:"FormInfosComplementairesIndividusCtrl"}).state("infos_complementaires.adresse_contact",{url:"/adresse?droit",templateUrl:"/partials/form-infos-complementaires/adresse-contact.html",controller:"FormInfosComplementairesAdresseContactCtrl"}).state("download_cerfa",{url:"/telecharger-formulaires/:droit",templateUrl:"/partials/download-cerfa.html",controller:"DownloadCerfaCtrl",resolve:{situation:["SituationService",function(a){return a.restoreLocal()}],droit:["$stateParams",function(a){return a.droit}]},data:{pageTitle:"Téléchargement formulaires - "}})}]),ddsApp.run(["$rootScope","$state","$stateParams","$window","$modalStack","$anchorScroll",function(a,b,c,d,e,f){a.$state=b,a.$stateParams=c,f.yOffset=60,a.$on("$locationChangeStart",function(a,b){0===b.indexOf(d.location.origin+"/api")&&(a.preventDefault(),d.location.href=b)}),a.$on("$stateChangeStart",function(){var a=e.getTop();a&&e.dismiss(a.key)}),a.$on("$locationChangeSuccess",function(a,b){d._paq&&(d._paq.push(["setCustomUrl",b]),d._paq.push(["trackPageView"]))})}]),angular.module("ddsCommon",[]),angular.module("ddsCommon").constant("situationsFamiliales",[{value:"mariage",label:"Marié(e)",isSituationCouple:!0},{value:"pacs",label:"Pacsé(e)",isSituationCouple:!0},{value:"relation_libre",label:"En relation libre",isSituationCouple:!0},{value:"celibataire",label:"Célibataire depuis toujours"},{value:"divorce",label:"Divorcé"},{value:"veuf",label:"Veuf"},{value:"separe",label:"Séparé de fait"},{value:"pacs_rompu",label:"Pacs rompu"},{value:"concubinage_rompu",label:"Concubinage rompu"}]),angular.module("ddsCommon").constant("ressourceCategories",[{id:"revenusActivite",label:"Revenus d’activité"},{id:"allocations",label:"Allocations"},{id:"indemnites",label:"Indemnités"},{id:"pensions",label:"Pensions"},{id:"tns",label:"Travailleurs non salariés"},{id:"autre",label:"Autres"}]),angular.module("ddsCommon").constant("ressourceTypes",[{id:"revenusSalarie",label:"Salaires, primes",category:"revenusActivite"},{id:"stage",label:"Rémunération de stage",category:"revenusActivite"},{id:"revenusStageFormationPro",label:"Revenus de stage de formation professionnelle",category:"revenusActivite"},{id:"allocationsChomage",label:"Allocation chômage (ARE)",category:"allocations"},{id:"allocationSecurisationPro",label:"Allocation de sécurisation professionnelle",category:"allocations"},{id:"primeRepriseActivite",label:"Prime forfaitaire mensuelle pour la reprise d’activité",category:"allocations"},{id:"aah",label:"Allocation adulte handicapé (AAH)",category:"allocations"},{id:"clca",label:"Complément de libre choix d’activité (CLCA)",category:"allocations"},{id:"prepare",label:"Prestation partagée d’éducation de l’enfant (PreParE)",category:"allocations"},{id:"indJourMaternite",label:"Indemnités de maternité, paternité, adoption",category:"indemnites"},{id:"indJourMaladie",label:"Indemnités maladie",category:"indemnites"},{id:"indJourMaladieProf",label:"Indemnités maladie professionnelle",category:"indemnites"},{id:"indJourAccidentDuTravail",label:"Indemnités d’accident du travail",category:"indemnites"},{id:"indChomagePartiel",label:"Indemnités d'activité partielle",category:"indemnites"},{id:"indVolontariat",label:"Indemnités de volontariat",category:"indemnites"},{id:"dedommagementAmiante",label:"Dédommagement aux victimes de l’amiante",category:"indemnites"},{id:"pensionsAlimentaires",label:"Pensions alimentaires",category:"pensions"},{id:"pensionsAlimentairesVersees",label:"Pensions alimentaires versées",category:"pensions"},{id:"prestationCompensatoire",label:"Prestation compensatoire (suite à séparation)",category:"pensions"},{id:"pensionsRetraitesRentes",label:"Retraite (y compris reversion), rentes",category:"pensions"},{id:"retraiteCombattant",label:"Retraite du combattant",category:"pensions"},{id:"pensionsInvalidite",label:"Pensions d'invalidité",category:"pensions"},{id:"bourseEnseignementSup",label:"Bourses de l'enseignement supérieur",category:"autre"},{id:"bourseRecherche",label:"Bourse de recherche",category:"autre"},{id:"gainsExceptionnels",label:"Gains exceptionnels (dons, gains aux jeux, héritage)",category:"autre"},{id:"caMicroEntreprise",label:"Micro-entreprise",category:"tns"},{id:"caAutoEntrepreneur",label:"Auto-entrepreneur",category:"tns"},{id:"revenusAgricolesTns",label:"Exploitant agricole",category:"tns"},{id:"autresRevenusTns",label:"Profession libérale, entrepreneur",category:"tns"}]),angular.module("ddsCommon").constant("categoriesRnc",[{id:"rncRevenusActivite",label:"Revenus d’activité connus"},{id:"rncAutresRevenus",label:"Autres revenus imposables (préretraite, chômage)"},{id:"rncPensionsRetraitesRentes",label:"Pensions, retraites, rentes"},{id:"rncPensionsAlimentaires",label:"Pensions alimentaires reçues"},{id:"rncPensionsAlimentairesVersees",label:"Pensions alimentaires versées"}]),angular.module("ddsCommon").constant("situationsPro",[{id:"sans_activite",label:"Sans activité"},{id:"salarie",label:"Salarié"},{id:"auto_entrepreneur",label:"Auto-entrepreneur"},{id:"travailleur_saisonnier",label:"Travailleur saisonnier"},{id:"apprenti",label:"Apprenti"},{id:"stagiaire",label:"Stagiaire de la formation professionnelle"},{id:"independant",label:"Travailleur indépendant ou employeur, y compris exploitant agricole"},{id:"gerant_salarie",label:"Gérant salarié"},{id:"demandeur_emploi",label:"Demandeur d'emploi",isStatutSpecifique:!0},{id:"etudiant",label:"Étudiant",isStatutSpecifique:!0},{id:"retraite",label:"Retraité",isStatutSpecifique:!0},{id:"handicap",label:"Handicap",isStatutSpecifique:!0},{id:"inapte_travail",label:"Inapte au travail",isStatutSpecifique:!0},{id:"autre",label:"Autre",isStatutSpecifique:!0}]),angular.module("ddsCommon").constant("nationalites",[{id:"fr",label:"française"},{id:"ue",label:"UE"},{id:"autre",label:"hors UE"}]),angular.module("ddsCommon").constant("logementTypes",[{id:"locataire",label:"locataire"},{id:"proprietaire",label:"propriétaire / en location-accession"},{id:"gratuit",label:"occupant à titre gratuit"}]),angular.module("ddsCommon").constant("locationTypes",[{id:"nonmeuble",label:"non meublé"},{id:"meublehotel",label:"meublé / hôtel"},{id:"foyer",label:"Foyer (résidence universitaire, maison de retraite, foyer de jeune travailleur, résidence sociale…)"}]),angular.module("ddsCommon").constant("loyerLabels",{locataire:"Votre loyer",proprietaire:"Votre mensualité totale d’emprunt (par mois)"}),angular.module("ddsApp").constant("cerfaForms",[{droitId:"cmu_c",description:'Le dossier doit être envoyé à la caisse d’assurance maladie dont vous dépendez.            Il peut être envoyé par courrier ou être déposé directement à votre caisse d’assurance maladie.            Pour obtenir l’adresse de votre caisse d’assurance maladie, <a href="http://www.cmu.fr/liste-caisses.php">cliquez ici</a>.',forms:[{id:"cmuc_demande",label:"Formulaire de demande",description:"Ce formulaire est obligatoire. Il faut le remplir une seule fois pour l’ensemble du foyer."},{id:"cmuc_choix_organisme_demandeur",label:"Formulaire de choix de l’organisme (demandeur)",description:'<strong>Ce formulaire est aussi obligatoire</strong>. Votre CMU-C/ACS sera gérée soit par votre caisse d’assurance maladie,                    soit par un organisme complémentaire inscrit sur une liste nationale que vous trouverez sur                    <a href="http://www.cmu.fr/liste-organismes-complementaires.php">ce lien</a>.'},{id:"cmuc_choix_organisme_non_demandeur",label:"Formulaire de choix de l’organisme (autres membres du foyer)",description:"Ce formulaire facultatif est à remplir, pour les autres membres du foyer,                    uniquement en cas de choix de l’organisme différent de celui du demandeur."}],piecesJustificatives:["vitale","identite","regularite","livret_famille","imposition","bulletins_paie","attestation_indemnites_chomage","taxe_fonciere","taxe_habitation","stabilite_residence"]},{droitId:"rsa",description:'Vous devez déposer votre demande auprès de l’un des organismes instructeurs de votre choix prévus par la loi :            Caisse d’allocations familiales (CAF), Mutualité sociale agricole (MSA), services du Conseil général,            Centre communal d’action sociale (CCAS) ou Centre intercommunal d’action sociale (CIAS) volontaires            ou bien une association ou un organisme à but non lucratif ayant reçu délégation du Conseil général.            Pour plus d’informations, vous pouvez consulter            <a href="http://www.social-sante.gouv.fr/espaces,770/handicap-exclusion,775/dossiers,806/le-rsa,2302/le-revenu-de-solidarite-active,2279/quelles-sont-les-demarches-a,14882.html">ce lien</a>.',forms:[{id:"rsa_demande",label:"Formulaire de demande"},{id:"rsa_non_salarie",label:"Formulaire complémentaire pour les non-salariés"},{id:"rsa_moins_25",label:"Formulaire complémentaire pour les moins de 25 ans"}],piecesJustificatives:["identite","titre_sejour","acte_naissance","ofii","avis_paiement_pension_invalidite","avis_paiement_retraite","avis_paiement_rente_accident_travail","declaration_revenus_saisonnier","declaration_grossesse","rib","taxe_habitation_patrimoine"]},{droitId:"aspa",description:"",forms:[{id:"aspa",label:"Formulaire de demande"}],piecesJustificatives:["imposition","domicile","titre_sejour"]},{droitId:"aide_logement",description:"",forms:[{id:"caf_demande_aide_logement",label:"Formulaire de demande"},{id:"caf_declaration_situation",label:"Déclaration de situation"},{id:"caf_declaration_ressources",label:"Déclaration de ressources"},{id:"caf_attestation_loyer",label:"Attestation de loyer"},{id:"caf_attestation_pret",label:"Certificat de prêt"},{id:"caf_attestation_residence_foyer",label:"Attestation de résidence en foyer"}],piecesJustificatives:["rib","declaration_grossesse","attestation_chomage_partiel","identite","titre_sejour","ofii"]}]),angular.module("ddsApp").constant("piecesJustificatives",[{id:"vitale",label:"Carte vitale et attestation",img:"carte_vitale.jpg",description:"Une photocopie de la carte vitale et l’attestation qui l’accompagne.            Cette attestation peut être obtenue auprès de votre caisse d’assurance maladie,            auprès d’une borne de votre caisse d’assurance maladie ou éventuellement via votre compte internet            sur le site de votre caisse d’assurance maladie."},{id:"identite",label:"Pièce d’identité",img:"identite_passeport.jpg",description:"Une photocopie recto-verso de votre carte d’identité, votre passeport ou votre livret de famille."},{id:"regularite",label:"Justificatif de régularité du séjour",img:"titre_sejour.jpg",description:"Toute pièce justifiant la régularité du séjour (contrat de travail, attestation de            chômage, titre de séjour, formulaires communautaires - E106 - E121/S1), récépissé            de votre demande de titre, convocation ou rendez-vous en préfecture"},{id:"titre_sejour",label:"Titre de séjour",img:"titre_sejour.jpg",description:"La photocopie lisible du titre de séjour en cours de validité."},{id:"livret_famille",label:"Livret de famille",img:"livret_famille.jpg",description:"Votre livret de famille tenu à jour.            Peut être remplacé par un certificat de concubinage ou une attestation d’enregistrement d’un PACS.",isIndividualized:!1},{id:"imposition",label:"Avis d’imposition ou de non-imposition",img:"impots.jpg",description:"Derniers avis d’imposition ou de non-imposition."},{id:"bulletins_paie",label:"Bulletins de paie",img:"bulletin_paie.jpg",description:"Les bulletins de paie sur l’année."},{id:"attestation_indemnites_chomage",label:"Attestations d’indemnités de chômage",img:"pole_emploi.png",description:"Attestations d’indemnités de chômage."},{id:"attestation_chomage_partiel",label:"Justificatif de chômage partiel",img:"bulletin_paie.jpg",description:"L’attestation de l’employeur ou la photocopie des bulletins de salaire."},{id:"taxe_fonciere",label:"Avis de taxe foncière",img:"taxe_fonciere.jpg",isIndividualized:!1},{id:"taxe_habitation",label:"Avis de taxe d’habitation",img:"taxe_habitation.jpg",isIndividualized:!1},{id:"taxe_habitation_patrimoine",label:"Avis de taxe d’habitation ou foncière (pour terrains ou logements non loués)",img:"taxe_habitation.jpg",description:"La photocopie du dernier avis de la taxe d’habitation ou de la taxe foncière de chaque terrain ou logement non loué que vous possédez.",isIndividualized:!1},{id:"stabilite_residence",label:"Justificatif de stabilité de résidence",img:"quittance.jpg",description:"Toute pièce justifiant que vous résidez en France depuis plus de trois mois.            Par exemple : bail de location, quittances de loyer, factures d’électricité consécutives,            certificat d’hébergement, certificat de scolarité ou d’inscription universitaire…",isIndividualized:!1},{id:"acte_naissance",label:"Extrait d’acte de naissance",img:"acte_naissance.jpg",description:"Un extrait d’acte de naissance pour les personnes à charges de moins            de 18 ans de nationalité étrangère et nées en France."},{id:"ofii",label:"Certificat de l’OFII",img:"ofii.jpg",description:"Le certificat de l’OFII (ex. Anaem) délivré dans le cadre du regroupement familial,            pour les personnes agées de moins de 18 ans, de nationalité étrangère et nées à l’étranger."},{id:"avis_paiement_pension_invalidite",label:"Avis de paiement de pension d’invalidité",img:"cheque.jpg",description:"La photocopie lisible du dernier avis de paiement de la pension d’invalidité."},{id:"avis_paiement_retraite",label:"Avis de paiement de pension de retraite",img:"cheque.jpg",description:"La photocopie lisible du dernier avis de paiement de la pension de retraite."},{id:"avis_paiement_rente_accident_travail",label:"Avis de paiement d’indemnité accident du travail",img:"cheque.jpg",description:"La photocopie lisible du dernier avis de paiement de l’indemnité d’accident du travail."},{id:"declaration_revenus_saisonnier",label:"Déclaration de revenus de travailleur saisonnier",img:"declaration_revenus.jpg",description:"La déclaration de revenus de l’année civile précédant la demande."},{id:"declaration_grossesse",label:"Déclaration de grossesse",img:"femme_enceinte.jpg",description:"La déclaration de grossesse établie par un praticien.",isIndividualized:!1},{id:"rib",label:"RIB",img:"rib.png",description:"Un relevé d’identité postal ou d’épargne ou bancaire.",isIndividualized:!1},{id:"domicile",label:"2 justificatifs de domicile",img:"quittance.jpg",description:"Quittances de loyer, factures d’eau, de gaz, d’électricité, de téléphone, attestation du Maire…",isIndividualized:!1}]),angular.module("ddsCommon").constant("droitsDescription",{cmu_c:{id:"cmu_c",label:"Couverture Maladie Universelle Complémentaire",shortLabel:"CMU-C",description:"La CMU-C est une protection complémentaire santé gratuite.",conditions:['Résider <abbr title="Métropole, Guadeloupe, Guyane, Martinique ou Réunion">en France</abbr> depuis plus de 3 mois.'],imgSrc:"logo_cmu.png",link:"http://www.cmu.fr/cmu-complementaire.php"},acs:{id:"acs",isMontantAnnuel:!0,label:"Aide pour une Complémentaire Santé",shortLabel:"ACS",description:"L’aide pour l’acquisition d’une assurance complémentaire santé, dite ACS, est une aide financière pour payer une complémentaire santé (exemple : une mutuelle).",conditions:['Résider <abbr title="Métropole, Guadeloupe, Guyane, Martinique ou Réunion">en France</abbr> depuis plus de 3 mois.'],imgSrc:"logo_cmu.png",link:"http://www.cmu.fr/acs.php"},aspa:{id:"aspa",label:"Allocation de Solidarité aux Personnes Âgées",shortLabel:"ASPA",description:"L’allocation de solidarité aux personnes âgées (Aspa) est une allocation destinée aux personnes âgées disposant de faibles revenus en vue de leur assurer un niveau minimum de ressources. Elle remplace le minimum vieillesse depuis 2006.",conditions:['Résider <abbr title="Métropole, Guadeloupe, Guyane, Martinique ou Réunion">en France</abbr> plus de <abbr title="180 jours, potentiellement discontinus">6 mois</abbr> cette année.'],imgSrc:"logo_aspa.png",link:"http://vosdroits.service-public.fr/particuliers/F16871.xhtml"},asi:{id:"asi",label:"Allocation Supplémentaire d’Invalidité",shortLabel:"ASI",description:"L’allocation supplémentaire d’invalidité (Asi) est une prestation versée sous certaines conditions aux personnes invalides titulaires d’une pension de retraite ou d’invalidité qui n’ont pas atteint l’âge légal de départ à la retraite pour bénéficier de l’allocation de solidarité aux personnes âgées (Aspa)",imgSrc:"logo_aspa.png",link:"http://vosdroits.service-public.fr/particuliers/F16940.xhtml"},af:{id:"af",label:"Allocations Familiales",shortLabel:"AF",description:"Les allocations familiales sont versées, sans condition de ressources, aux personnes ayant au moins 2 enfants de moins de 20 ans à charge. Le montant des prestations dépend du nombre d’enfants à charge et de leur âge.",conditions:['Résider <abbr title="Métropole, Guadeloupe, Guyane, Martinique ou Réunion">en France</abbr> plus de <abbr title="180 jours, potentiellement discontinus">6 mois</abbr> cette année.'],imgSrc:"logo_caf.png",link:"http://www.caf.fr/aides-et-services/s-informer-sur-les-aides/petite-enfance/les-allocations-familiales-af-0"},cf:{id:"cf",label:"Complément Familial",shortLabel:"CF",description:"Le complément familial est versé, sous certaines conditions, aux personnes ayant au moins 3 enfants à charge.",imgSrc:"logo_caf.png",link:"http://www.caf.fr/aides-et-services/s-informer-sur-les-aides/enfance-et-jeunesse/le-complement-familialcf",isBaseRessourcesYearMoins2:!0},asf:{id:"asf",label:"Allocation de Soutien Familial",shortLabel:"ASF",description:"L’ASF est versée par la CAF ou la MSA au parent qui élève seul son enfant ou à la personne qui a recueilli un enfant, qu’elle vive seule ou en couple.",conditions:["Ne pas toucher l’intégralité d’une pension alimentaire qui vous aurait été attribuée par une décision de justice, ou que cette pension soit d’un montant inférieur à celui de l’ASF."],imgSrc:"logo_caf.png",link:"http://vosdroits.service-public.fr/particuliers/F815.xhtml"},paje_base:{id:"paje_base",label:"Prestation d’Accueil du Jeune Enfant - Allocation de base",shortLabel:"PAJE-BASE",description:"L’allocation de base vous aide à assurer les dépenses liées à l’entretien et à l’éducation de votre enfant.",imgSrc:"logo_caf.png",link:"https://www.caf.fr/aides-et-services/s-informer-sur-les-aides/petite-enfance/l-allocation-de-base",isBaseRessourcesYearMoins2:!0},rsa:{id:"rsa",label:"Revenu de Solidarité Active",shortLabel:"RSA",description:"Le RSA est destiné à assurer aux personnes disposant de faibles ressources un niveau minimum de revenu variable selon la composition de leur foyer.",conditions:["Résider en France plus de 9 mois par an.","Si vous êtes ressortissant.e d’un pays de l’UE, de l’EEE ou Suisse, résider en France depuis plus de 3 mois.","Si vous êtes ressortissant.e d’un autre pays, résider en France depuis plus de 5 ans."],imgSrc:"logo_rsa.png",link:"http://vosdroits.service-public.fr/particuliers/N19775.xhtml",uncomputability:{tns:{reason:"vous avez des revenus en tant qu’indépendant.e",solution:'Vous pouvez demander à bénéficier du RSA, mais c’est le président de votre conseil départemental qui <a title="Article R262-23 du code de l\'action sociale" href="http://www.legifrance.gouv.fr/affichCodeArticle.do?idArticle=LEGIARTI000028251799&cidTexte=LEGITEXT000006074069">décidera</a> de la manière dont vos revenus non salariés impacteront le montant de votre aide.'},conjoint_tns:{reason:"votre conjoint.e a des revenus en tant qu’indépendant.e",solution:'Vous pouvez demander à bénéficier du RSA, mais c’est le président de votre conseil départemental qui <a title="Article R262-23 du code de l\'action sociale" href="http://www.legifrance.gouv.fr/affichCodeArticle.do?idArticle=LEGIARTI000028251799&cidTexte=LEGITEXT000006074069">décidera</a> de la manière dont les revenus non salariés de votre conjoint.e impacteront le montant de votre aide.'}}},aide_logement:{id:"aide_logement",label:"Aides au Logement",shortLabel:"AL",description:"L'aide au logement est une aide financière destinée à réduire le montant de votre loyer ou votre mensualité d’emprunt immobilier. Elle est attribuée selon la nature de votre logement et la composition de votre famille.",conditions:["Résider au moins 8 mois par an dans le logement que vous avez décrit.",'Le logement doit être <a href="http://www.caf.fr/aides-et-services/connaitre-vos-droits-selon-votre-situation/vous-louez-ou-vous-achetez-un-logement/vous-occupez-un-logement-insalubre-ou-non-decent" title="9 mètres carrés par personne, fenêtre, WC, eau potable, électricité" >décent</a>.'],imgSrc:"logo_caf.png",link:"https://www.caf.fr/aides-et-services/s-informer-sur-les-aides/logement-et-cadre-de-vie/les-aides-au-logement-0",isBaseRessourcesYearMoins2:!0,uncomputability:{proprietaire:{reason:"vous êtes propriétaire",solution:'Le <a href="https://wwwd.caf.fr/wps/portal/caffr/aidesetservices/lesservicesenligne/estimervosdroits/lelogement">simulateur de la CAF</a> pourra estimer vos droits sur la base de la valeur de votre bien.'},locataire_foyer:{reason:"vous logez dans un foyer",solution:'Le <a href="https://wwwd.caf.fr/wps/portal/caffr/aidesetservices/lesservicesenligne/estimervosdroits/lelogement">simulateur de la CAF</a> vous donnera des estimations selon les différentes conventions possibles de votre foyer.'}}},ass:{id:"ass",label:"Allocation de Solidarité Spécifique",shortLabel:"ASS",description:"L’allocation de solidarité spécifique (ASS) est une aide financière destinée aux personnes ayant épuisé leurs droits aux allocations chômage.",imgSrc:"logo_ass.png",link:"http://vosdroits.service-public.fr/particuliers/F12484.xhtml"},bourse_college:{id:"bourse_college",isMontantAnnuel:!0,label:"Bourse de collège",shortLabel:"Bourse collège",description:"La bourse des collèges est une aide destinée à favoriser la scolarité des collégiens. Elle est versée sous conditions de ressources.",imgSrc:"logo_education_nationale.png",link:"http://www.education.gouv.fr/cid88/les-aides-financieres-au-college.html#Les%20bourses%20de%20coll%C3%A8ge",isBaseRessourcesYearMoins2:!0},bourse_lycee:{id:"bourse_lycee",isMontantAnnuel:!0,label:"Bourse de lycée",shortLabel:"Bourse lycée",description:"La bourse des lycées est accordée, sous condition de ressources, à la famille d’un lycéen. Son montant dépend des ressources et des charges de la famille. Cette bourse peut être accompagnée de diverses primes (prime d’équipement, prime à la qualification, bourse au mérite au lycée, prime à l’internat...).",imgSrc:"logo_education_nationale.png",link:"http://www.education.gouv.fr/cid151/aides-financieres-au-lycee.html#Les%20bourses%20de%20lycée",isBaseRessourcesYearMoins2:!0}}),angular.module("ddsApp").controller("BodyCtrl",["$scope","$localStorage","$timeout","SituationService",function(a,b,c,d){a.showIntro=!1,!1!==b.showIntro&&c(function(){a.showIntro=!0},500),a.hideIntro=function(){a.showIntro=!1,b.showIntro=!1},a.newSituation=function(){d.newSituation()}}]),angular.module("ddsApp").controller("HomepageCtrl",["$scope","droitsDescription",function(a,b){a.droits=b}]),angular.module("ddsApp").controller("ContribuezCtrl",function(){!function(a,b,c){var d,e=a.getElementsByTagName(b)[0],f=/^http:/.test(a.location)?"http":"https";a.getElementById(c)?twttr.widgets.load():(d=a.createElement(b),d.id=c,d.src=f+"://platform.twitter.com/widgets.js",e.parentNode.insertBefore(d,e))}(document,"script","twitter-wjs")}),angular.module("ddsApp").controller("FoyerCtrl",["$scope","$state","$stateParams","$filter","$location","$modal","SituationService","IndividuService",function(a,b,c,d,e,f,g,h){var i=a.situation=g.restoreLocal();a.$on("setSituation",function(b,c){i=a.situation=c}),a.statutsSpecifiques=h.formatStatutsSpecifiques,a.nationalite=h.nationaliteLabel,a.getLabel=h.label,a.$on("individu.demandeur",function(a,c){_.find(i.individus,{role:"demandeur"})?i.individus[0]=c:i.individus.push(c),b.go("foyer.conjoint")}),a.$on("individu.conjoint",function(a,c){c?_.find(i.individus,{role:"conjoint"})?i.individus[1]=c:i.individus.splice(1,0,c):i.individus=_.filter(i.individus,function(a){return"conjoint"!==a.role}),b.go("foyer.personnesACharge")}),a.$on("personnesACharge",function(a,c){i.individus=_.filter(i.individus,function(a){return"personneACharge"!==a.role&&"enfant"!==a.role}),i.individus=i.individus.concat(c),b.go("foyer.logement")});var j=function(a){return 0===a.adresse.codePostal.indexOf("976")};a.$on("logement",function(c,d){i.logement=d,a.$broadcast("logementCaptured"),j(d)?f.open({templateUrl:"/partials/modal-exclusion-mayotte.html"}):b.go("foyer.ressources")});var k=function(){g.save(a.situation).then(function(){b.transitionTo("situation",{situationId:a.situation._id},{location:!1})})};a.$on("ressources",function(){a.situation.ressourcesCaptured=!0,a.$broadcast("ressourcesUpdated"),b.go("foyer.pensionsAlimentaires")}),a.$on("pensionsAlimentaires",function(){k()}),a.$on("rnc",function(){g.hasEnfantScolarise(a.situation)?b.go("foyer.rfr"):(a.situation.ressourcesYearMoins2Captured=!0,a.$broadcast("ressourcesYearMoins2Captured"),k())}),a.$on("rfr",function(b,c){a.situation.rfr=c,a.situation.ressourcesYearMoins2Captured=!0,a.$broadcast("ressourcesYearMoins2Captured"),k()}),a.$on("patrimoine",function(b,c){i.patrimoine=c,a.$broadcast("patrimoineCaptured"),k()})}]),angular.module("ddsApp").controller("FoyerIndividuFormCtrl",["$scope","options","situationsFamiliales","SituationService","IndividuService",function(a,b,c,d,e){a.statutsSpecifiques=e.getStatutsSpecifiques(),b.minAge=0,b.maxAge=130,"enfant"===b.individuRole&&(b.maxAge=25,b.formPersonneACharge=!0,b.captureGardeAlternee=!0,a.statutsSpecifiques=_.filter(a.statutsSpecifiques,function(a){return"retraite"!==a.id})),a.options=b,a.selectedStatuts={},a.situationsMaritales=_.filter(c,"isSituationCouple"),a.scolariteOptions=[{id:"inconnue",label:"Aucun des deux"},{id:"college",label:"Au collège"},{id:"lycee",label:"Au lycée / En CAP / En CPA"}],a.individu={nationalite:"fr",assPreconditionRemplie:!1,scolarite:"college",tauxInvalidite:"moins50",boursier:!1,role:b.individuRole},!0==(a.captureRelationConjoint=!!b.captureRelationConjoint)&&(a.individu.statutMarital="mariage");var f=e.isRoleParent(b.individuRole);if(f){var g=_.find(a.situation.individus,{role:b.individuRole});g&&(a.individu=_.merge(a.individu,g),a.individu.situationsPro.forEach(function(b){a.selectedStatuts[b.situation]=!0}))}a.submit=function(c){a.submitted=!0,c.$valid&&(a.individu.situationsPro=[],_.forEach(a.selectedStatuts,function(b,c){b&&a.individu.situationsPro.push({situation:c})}),a.captureEligibiliteAss()||delete a.individu.assPreconditionRemplie,a.captureTauxInvalidite()||delete a.individu.tauxInvalidite,a.captureEtudiantBoursier()||delete a.individu.boursier,a.captureScolarite(c)||delete a.individu.scolarite,a.$emit("individu."+b.individuRole,a.individu))},a.captureEligibiliteAss=function(){return f&&a.selectedStatuts.demandeur_emploi},a.captureTauxInvalidite=function(){return f&&a.selectedStatuts.handicap},a.captureEtudiantBoursier=function(){return a.selectedStatuts.etudiant},a.captureScolarite=function(b){if(!f&&b.dateDeNaissance.$valid){var c=e.age(a.individu);return 25>c&&c>8}return!1},a.cancel=function(){a.$emit("actionCancelled")},a.popoverEee="Allemagne, Autriche, Belgique, Bulgarie, Chypre, Croatie, Danemark, Espagne, Estonie, Finlande, France, Grèce, Hongrie, Irlande, Islande, Italie, Lettonie, Liechtenstein, Lituanie, Luxembourg, Malte, Norvège, Pays-Bas, Pologne, Portugal, République Tchèque, Roumanie, Royaume-Uni, Slovaquie, Slovénie, Suède."}]),angular.module("ddsApp").controller("FoyerConjointCtrl",["$scope",function(a){_.find(a.situation.individus,{role:"conjoint"})&&(a.vitEnCouple=!0)}]),angular.module("ddsApp").controller("FoyerPersonnesAChargeCtrl",["$scope","$location","$anchorScroll","$timeout",function(a,b,c,d){a.enfants=_.where(a.situation.individus,{role:"enfant"}),a.$on("individu.enfant",function(b,c){a.enfants.push(c),a.displayForm=!1}),a.$on("actionCancelled",function(){a.displayForm=!1}),a.newEnfant=function(){a.displayForm=!0,d(function(){b.hash("form-scroll"),c()
})},a.removeEnfant=function(b){var c=a.enfants.indexOf(b);a.enfants.splice(c,1)},a.validate=function(){a.$emit("personnesACharge",a.enfants)}}]),angular.module("ddsApp").controller("FoyerLogementCtrl",["$scope","$http","logementTypes","locationTypes","loyerLabels",function(a,b,c,d,e){var f=a.logement={adresse:{}};a.situation.logement&&(f=a.logement=_.merge(f,a.situation.logement)),a.logementTypes=c,a.locationTypes=d,a.loyerLabel=function(){var a=e[f.type];return"locataire"===f.type&&(a+="meublehotel"===f.locationType?" (charges comprises)":" (hors charges)"),a},a.captureMembreFamilleProprietaire=function(){return"locataire"===f.type&&angular.isDefined(f.colocation)},a.capturePretConventionne=function(){return!0===f.primoAccedant},a.captureLocationType=function(){return"locataire"===f.type&&angular.isDefined(f.membreFamilleProprietaire)},a.captureChambre=function(){return"locataire"===f.type&&"foyer"!==f.locationType&&angular.isDefined(f.locationType)},a.captureLoyer=function(){return"gratuit"===f.type?!1:_.any([!0===f.primoAccedant&&angular.isDefined(f.pretConventionne),"foyer"===f.locationType,angular.isDefined(f.isChambre)])},a.captureCodePostal=function(){return _.any([!1===f.primoAccedant||!0===f.primoAccedant&&angular.isDefined(f.pretConventionne),"foyer"===f.locationType,angular.isDefined(f.isChambre),"gratuit"===f.type])},a.changeLogementType=function(){["colocation","locationType","membreFamilleProprietaire","primoAccedant","loyer","isChambre"].forEach(function(a){delete f[a]})},a.updateCities=function(){a.retrievingCities=!0,b.get("/api/outils/communes/"+a.postalCode).then(function(b){a.cities=b.data,f.adresse=a.cities[0]},console.error.bind(console))["finally"](function(){a.retrievingCities=!1})},a.submit=function(b){a.submitted=!0,b.$valid&&f.adresse&&a.$emit("logement",f)}}]),angular.module("ddsApp").controller("FoyerRessourcesCtrl",["$scope","$state","ressourceTypes","categoriesRnc","SituationService","IndividuService","RessourceService",function(a,b,c,d,e,f,g){var h=moment(a.situation.dateDeValeur).subtract("years",1),i=moment(a.situation.dateDeValeur).startOf("month").subtract("months",1);a.debutAnneeGlissante=h.format("MMMM YYYY"),a.finAnneeGlissante=i.format("MMMM YYYY"),a.months=e.getMonths(a.situation.dateDeValeur),a.yearMoinsUn=moment(a.situation.dateDeValeur).subtract("years",1).format("YYYY"),a.currentMonth=moment(a.situation.dateDeValeur).format("MMMM YYYY"),a.onGoingLabel="J’aurai un chiffre d’affaires non nul en "+a.currentMonth,a.ressourceTypes=_.indexBy(c,"id");var j=function(a){var b={},c=a.ressources||[];return _.chain(c).pluck("type").unique().forEach(function(a){b[a]=!0}),["caMicroEntreprise","caAutoEntrepreneur","revenusAgricolesTns","autresRevenusTns"].forEach(function(c){a[c]&&(b[c]=!0)}),b},k=function(b){var d=[],e=b.ressources||[],f=_.chain(e).pluck("type").unique().filter(function(a){return!_.contains(["pensionsAlimentairesVersees"],a)});if(f.forEach(function(f){if("caAutoEntrepreneur"!=f){var g=_.find(c,{id:f});if(g){var h=_.map(a.months,function(a){var b=_.find(e,{periode:a.id,type:f});return b?Math.round(b.montant):0}),i=_.chain(e).where({type:f}).pluck("montant").reduce(function(a,b){return a+b}).value();i=Math.round(i);var j={type:g,montantsMensuels:h,montantAnnuel:i,onGoing:!0};_.contains(b.interruptedRessources,f)&&(j.onGoing=!1),d.push(j)}}}),b.caMicroEntreprise&&d.push({type:_.find(c,{id:"caMicroEntreprise"}),tnsActiviteType:b.microEntrepriseActiviteType,montantAnnuel:b.caMicroEntreprise}),b.caAutoEntrepreneur){var g=_.map(a.months,function(a){var b=_.find(e,{periode:a.id,type:"caAutoEntrepreneur"}||{montant:0});return Math.round(b.montant)});d.push({type:_.find(c,{id:"caAutoEntrepreneur"}),tnsActiviteType:b.autoEntrepreneurActiviteType,montantAnnuel:b.caAutoEntrepreneur,montantsMensuels:g,onGoing:!_.contains(b.interruptedRessources,"caAutoEntrepreneur")})}return b.autresRevenusTns&&d.push({type:_.find(c,{id:"autresRevenusTns"}),montantAnnuel:b.autresRevenusTns,employes:b.autresRevenusTnsEmployes,caAnnuel:b.caAutresRevenusTns,tnsActiviteType:b.autresRevenusTnsActiviteType}),b.revenusAgricolesTns&&d.push({type:_.find(c,{id:"revenusAgricolesTns"}),montantAnnuel:b.revenusAgricolesTns}),d};a.individusVM=_.map(a.situation.individus,function(a){return{individu:a,label:f.label(a),selectedRessourceTypes:j(a),ressources:k(a)}}),a.montantInvalide=function(a){return!angular.isNumber(a)};var l=function(b){var c=b.individu,e=c.ressources;c.ressources=[],c.interruptedRessources=[],b.ressources.forEach(function(b){if("tns"===b.type.category)switch(b.type.id){case"autresRevenusTns":c.autresRevenusTns=b.montantAnnuel,c.caAutresRevenusTns=b.caAnnuel,c.autresRevenusTnsActiviteType=b.tnsActiviteType,c.autresRevenusTnsEmployes=b.employes;break;case"revenusAgricolesTns":c.revenusAgricolesTns=b.montantAnnuel;break;case"caAutoEntrepreneur":c.autoEntrepreneurActiviteType=b.tnsActiviteType,c.caAutoEntrepreneur=b.montantAnnuel,g.spreadIndividuRessources(c,a.months,b,a.situation.dateDeValeur);break;case"caMicroEntreprise":c.microEntrepriseActiviteType=b.tnsActiviteType,c.caMicroEntreprise=b.montantAnnuel}else g.spreadIndividuRessources(c,a.months,b,a.situation.dateDeValeur)}),c.ressources=c.ressources.concat(_.where(e,function(a){return!!_.find(d,{id:a.type})||_.contains(["pensionsAlimentairesVersees"],a.type)})),c.caMicroEntreprise&&!b.selectedRessourceTypes.caMicroEntreprise&&(c.caMicroEntreprise=null),c.autresRevenusTns&&!b.selectedRessourceTypes.autresRevenusTns&&(c.autresRevenusTns=null)};a.submit=function(b){b.submitted=!0,b.$valid&&(a.individusVM.forEach(l),a.$emit("ressources"))}}]),angular.module("ddsApp").controller("FoyerRessourceTypesCtrl",["$scope","$stateParams","ressourceCategories","ressourceTypes","$state",function(a,b,c,d,e){a.ressourceCategories=c,a.individuVM=a.individusVM[b.individu];var f=_.filter(d,function(a){return!_.contains(["pensionsAlimentairesVersees"],a.id)});a.ressourceTypesByCategories=_.groupBy(f,"category");var g=function(){switch(a.individuVM.individu.role){case"demandeur":return"Vos ressources";case"conjoint":return"Les ressources de votre conjoint";default:return"Les ressources de "+a.individuVM.individu.firstName}};a.pageTitle=g();var h=function(){var b=a.individuVM.ressources;a.individuVM.ressources=[],d.forEach(function(c){if(a.individuVM.selectedRessourceTypes[c.id]){var d=_.find(b,{type:c});d||(d={type:c,montantAnnuel:0},"caMicroEntreprise"===c.id?d.tnsActiviteType="bic":"caAutoEntrepreneur"===c.id?(d.tnsActiviteType="bic",d.montantsMensuels=[0,0,0],d.onGoing=!0):"tns"!==c.category&&(d.montantsMensuels=[0,0,0],d.onGoing=!0)),a.individuVM.ressources.push(d)}})};a.submit=function(){h(),e.go("foyer.ressources")}}]),angular.module("ddsApp").controller("FoyerRessourceYearMoins2Ctrl",["$scope","$state","categoriesRnc","IndividuService",function(a,b,c,d){a.yearMoins2=moment(a.situation.dateDeValeur).subtract("years",2).format("YYYY");var e=d.getParents(a.situation.individus);a.individuRefs=[],e.forEach(function(b){var e={individu:b,label:d.label(b),rnc:[]};c.forEach(function(a){var c=_.find(b.ressources,{type:a.id}),d=c?c.montant:0;e.rnc.push({categorie:a,montant:d})}),a.individuRefs.push(e)}),a.submit=function(){a.individuRefs.forEach(function(b){b.individu.ressources=_.filter(b.individu.ressources,function(a){return!_.find(c,{id:a.type})}),b.rnc.forEach(function(c){b.individu.ressources.push({periode:a.yearMoins2,type:c.categorie.id,montant:c.montant})})}),a.$emit("rnc")}}]),angular.module("ddsApp").controller("FoyerPensionsAlimentairesCtrl",["$scope","ressourceTypes","SituationService","IndividuService","RessourceService",function(a,b,c,d,e){var f=moment(a.situation.dateDeValeur).subtract("years",1),g=moment(a.situation.dateDeValeur).startOf("month").subtract("months",1);a.debutAnneeGlissante=f.format("MMMM YYYY"),a.finAnneeGlissante=g.format("MMMM YYYY"),a.currentMonth=moment(a.situation.dateDeValeur).format("MMMM YYYY");var h=c.getMonths(a.situation.dateDeValeur),i=function(a,b){var c=_.map(h,function(c){var d=_.find(a.ressources,{periode:c.id,type:b});return d?Math.round(d.montant):0});return c},j=function(a,b){var c=_.chain(a.ressources).where({type:b}).pluck("montant").reduce(function(a,b){return a+b}).value();return c||0};a.pensionsVersees=_.find(b,{id:"pensionsAlimentairesVersees"});var k=function(b){var c={individu:b,label:d.label(b),pensionsVersees:{type:a.pensionsVersees,montantsMensuels:i(b,"pensionsAlimentairesVersees"),montantAnnuel:j(b,"pensionsAlimentairesVersees"),onGoing:!0}};return c},l=_.find(a.situation.individus,{role:"demandeur"}),m=_.find(a.situation.individus,{role:"conjoint"});a.individusVM=[k(l)],m&&a.individusVM.push(k(m)),a.hasPensionsAlimentaires=!1,a.individusVM.forEach(function(b){_.any([_.find(b.individu.ressources,{type:"pensionsAlimentairesVersees"})])&&(a.hasPensionsAlimentaires=!0)});var n=function(b,c){var d=b.individu,f=b[c];e.spreadIndividuRessources(d,h,f,a.situation.dateDeValeur)};a.submit=function(){a.individusVM.forEach(function(b){a.hasPensionsAlimentaires?["pensionsVersees"].forEach(function(a){n(b,a)}):b.individu.ressources=_.filter(b.individu.ressources,function(a){return!_.contains(["pensionsAlimentairesVersees"],a.type)})}),a.$emit("pensionsAlimentaires")}}]),angular.module("ddsApp").controller("FoyerRessourceRfrCtrl",["$scope",function(a){a.yearMoins2=moment(a.situation.dateDeValeur).subtract("years",2).format("YYYY"),a.yearMoins1=moment(a.situation.dateDeValeur).subtract("years",1).format("YYYY"),a.rfr=a.situation.rfr||0,a.submit=function(){a.$emit("rfr",a.rfr)}}]),angular.module("ddsCommon").controller("RecapSituationCtrl",["$scope","$state","$filter","nationalites","ressourceTypes","logementTypes","locationTypes","categoriesRnc","SituationService","IndividuService",function(a,b,c,d,e,f,g,h,i,j){var k=function(){var b=_.find(f,{id:a.situation.logement.type}).label;b=c("uppercaseFirst")(b),a.recapLogement="<b>"+b+"</b>","locataire"===a.situation.logement.type?(a.recapLogement+=" d’un logement <b>",a.recapLogement+=_.find(g,{id:a.situation.logement.locationType}).label,a.recapLogement+="</b>",a.loyerLabel="Loyer"):a.loyerLabel="Mensualité d’emprunt"};a.situation.logement&&k(),a.$on("logementCaptured",function(){k()});var l=function(){a.patrimoine=[],[{id:"valeurLocativeImmoNonLoue",label:"Valeur locative immobilier non loué"},{id:"valeurLocativeTerrainNonLoue",label:"Valeur locative terrains non loués"},{id:"epargneSurLivret",label:"Epargne sur livret"},{id:"epargneSansRevenus",label:"Epargne sans revenus"}].forEach(function(b){a.situation.patrimoine[b.id]&&a.patrimoine.push({label:b.label,montant:a.situation.patrimoine[b.id]})}),a.revenusDuPatrimoine=[],[{id:"revenusDuCapital",label:"Revenus du capital"},{id:"revenusLocatifs",label:"Revenus locatifs"}].forEach(function(b){var c=a.situation.patrimoine[b.id];if(c.length){var d={label:b.label,values:[]};a.revenusDuPatrimoine.push(d);for(var e=0;3>e;e++){var f=c[e];d.values.push({periode:moment(f.periode,"YYYY-MM").format("MMMM YYYY"),montant:f.montant})}var g=_.pluck(c,"montant"),h=_.reduce(g,function(a,b){return a+b});h=Math.round(h),d.values.push({periode:"Année glissante",montant:h})}})};a.situation.patrimoine&&a.situation.patrimoine.captured&&l(),a.$on("patrimoineCaptured",function(){l()}),a.months=i.getMonths(a.situation.dateDeValeur),a.lastMonth=moment(a.situation.dateDeValeur).subtract("months",1).startOf("month").format("MMMM YYYY"),a.lastYear=moment(a.situation.dateDeValeur).subtract("years",1).format("MMMM YYYY"),a.yearMoinsUn=moment(a.situation.dateDeValeur).subtract("years",1).format("YYYY"),a.yearMoins2=moment(a.situation.dateDeValeur).subtract("years",2).format("YYYY");var m=function(b){if(b.ressources){var c=_.chain(b.ressources).pluck("type").unique();c.forEach(function(c){if(_.find(e,{id:c})){var d=_.map(a.months,function(a){var d=_.find(b.ressources,{type:c,periode:a.id});return d?d.montant:0}),f=_.chain(b.ressources).where({type:c}).pluck("montant").reduce(function(a,b){return a+b}).value(),g=a.tempRessources[c];g?(_.map([0,1,2],function(a){g.totalMensuel[a]+=d[a]}),g.totalAnnuel+=f):g=a.tempRessources[c]={totalMensuel:d,totalAnnuel:f},a.globalAmount+=f}})}},n=function(){a.tempRessources={},a.hasRessources=!1,a.hasRessourcesTns=!1,a.hasRessourcesNonTns=!1,a.globalAmount=0,a.isSituationMonoIndividu=1===a.situation.individus.length,a.situation.individus.forEach(m),a.globalAmount>0&&(a.hasRessources=!0),a.ressourcesTns=[],a.ressourcesNonTns=[],e.forEach(function(b){a.tempRessources[b.id]&&a.ressourcesNonTns.push({type:b,totalMensuel:a.tempRessources[b.id].totalMensuel,totalAnnuel:Math.round(a.tempRessources[b.id].totalAnnuel)})});var b={type:_.find(e,{id:"caMicroEntreprise"}),totalAnnuel:0},c={type:_.find(e,{id:"autresRevenusTns"}),totalAnnuel:0},d={type:_.find(e,{id:"revenusAgricolesTns"}),totalAnnuel:0};a.situation.individus.forEach(function(e){e.caMicroEntreprise&&(b.totalAnnuel+=e.caMicroEntreprise,a.hasRessources=!0),e.autresRevenusTns&&(c.totalAnnuel+=e.autresRevenusTns,a.hasRessources=!0),e.revenusAgricolesTns&&(d.totalAnnuel+=e.revenusAgricolesTns,a.hasRessources=!0)}),b.totalAnnuel&&a.ressourcesTns.push(b),c.totalAnnuel&&a.ressourcesTns.push(c),d.totalAnnuel&&a.ressourcesTns.push(d)};a.situation.individus.length&&a.situation.individus[0].ressources&&(a.ressourcesCaptured=!0,n()),a.$on("ressourcesUpdated",function(){a.ressourcesCaptured=!0,n()});var o=function(){a.rfrCaptured=angular.isDefined(a.situation.rfr),a.ressourcesYearMoins2=[];var b=j.getParents(a.situation.individus);b.forEach(function(b){var c={label:j.label(b),rnc:[]};h.forEach(function(a){var d=_.find(b.ressources,{type:a.id});d&&c.rnc.push({label:a.label,montant:d.montant})}),c.rnc.length&&a.ressourcesYearMoins2.push(c)})};a.situation.ressourcesYearMoins2Captured&&o(),a.$on("ressourcesYearMoins2Captured",o)}]),angular.module("ddsApp").controller("FoyerPatrimoineCtrl",["$scope","SituationService",function(a,b){var c=moment(a.situation.dateDeValeur).startOf("month").subtract("years",1);a.debutPeriode=c.format("MMMM YYYY");var d=moment(a.situation.dateDeValeur).startOf("month").subtract("months",1);a.finPeriode=d.format("MMMM YYYY"),a.months=b.getMonths(a.situation.dateDeValeur),a.revenusLocatifs={months:[{montant:0},{montant:0},{montant:0}],year:0},a.revenusDuCapital={months:[{montant:0},{montant:0},{montant:0}],year:0},a.patrimoine={hasImmobilier:!1,valeurLocativeImmoNonLoue:0,valeurLocativeTerrainNonLoue:0,hasMobilier:!1,epargneSurLivret:0,epargneSansRevenus:0},a.updateRevenusLocatifsYearAmount=function(){var b=_.map(a.revenusLocatifs.months,function(a){return a.montant});a.revenusLocatifs.year=Math.round(4*_.reduce(b,function(a,b){return a+b}))},a.updateRevenusDuCapitalYearAmount=function(){var b=_.map(a.revenusDuCapital.months,function(a){return a.montant});a.revenusDuCapital.year=Math.round(4*_.reduce(b,function(a,b){return a+b}))},a.submit=function(){a.patrimoine.revenusLocatifs=[],a.patrimoine.hasImmobilier&&([0,1,2].forEach(function(b){a.patrimoine.revenusLocatifs.push({periode:a.months[b].id,montant:a.revenusLocatifs.months[b].montant})}),a.patrimoine.revenusLocatifs.push({debutPeriode:c.format("YYYY-MM"),finPeriode:d.format("YYYY-MM"),montant:a.revenusLocatifs.year})),a.patrimoine.revenusDuCapital=[],a.patrimoine.hasMobilier&&([0,1,2].forEach(function(b){a.patrimoine.revenusDuCapital.push({periode:a.months[b].id,montant:a.revenusDuCapital.months[b].montant})}),a.patrimoine.revenusDuCapital.push({debutPeriode:c.format("YYYY-MM"),finPeriode:d.format("YYYY-MM"),montant:a.revenusDuCapital.year})),a.patrimoine.captured=!0,a.$emit("patrimoine",a.patrimoine)}}]),angular.module("ddsApp").controller("SimulationCtrl",["$scope","$rootScope","$window","$http","$state","$stateParams","$timeout","SituationService","SimulationService","CerfaService",function(a,b,c,d,e,f,g,h,i,j){a.yearMoins2=moment(a.situation.dateDeValeur).subtract("years",2).format("YYYY"),a.debutPeriode=moment(a.situation.dateDeValeur).startOf("month").subtract("years",1).format("MMMM YYYY"),a.finPeriode=moment(a.situation.dateDeValeur).startOf("month").subtract("months",1).format("MMMM YYYY"),a.awaitingResults=!0,a.error=!1,a.droits=null,a.droitsNonEligibles=null,i.simulate(a.situation).then(function(b){a.droits=b,a.droitsNonEligibles=i.complement(b),a.noDroits=_.isEmpty(b)},function(){a.error=!0})["finally"](function(){a.awaitingResults=!1}),a.createTest=function(){var b=_.map(a.droits,function(a,b){return{code:b,expectedValue:a.montant}});d.post("api/acceptance-tests",{expectedResults:b,scenario:{situationId:a.situation._id}}).success(function(a){c.location.href="/tests/"+a._id+"/edit"}).error(function(a){c.alert(a)})},a.round=function(a){return 10*Math.round(a/10)},a.hasCerfa=j.getCerfaFromDroit,a.isNumber=_.isNumber,a.isString=_.isString}]),angular.module("ddsApp").controller("FormInfosComplementairesIndividusCtrl",["$scope","$state","$stateParams","situationsFamiliales","SituationService",function(a,b,c,d,e){var f=a.situation=e.restoreLocal();a.situationsFamiliales=d,a.demandeur=_.find(f.individus,{role:"demandeur"}),a.conjoint=_.find(f.individus,{role:"conjoint"}),a.conjoint&&(a.situationMaritale=_.find(d,{value:a.conjoint.statutMarital}).label),a.enfants=_.where(f.individus,{role:"enfant"}),f.individus.forEach(function(a){a.paysNaissance?a.choicePaysNaissance="France"===a.paysNaissance?"france":"autre":(a.choicePaysNaissance="france",a.paysNaissance="France"),a.civilite||(a.civilite="conjoint"===a.role?"f":"h")}),a.changePaysNaissance=function(a){"autre"===a.choicePaysNaissance?(a.paysNaissance="",a.villeNaissance=null,a.departementNaissance=null):a.paysNaissance="France"},a.submit=function(){b.go("infos_complementaires.adresse_contact",{droit:c.droit})}}]),angular.module("ddsApp").controller("FormInfosComplementairesAdresseContactCtrl",["$scope","$state","$stateParams","SituationService",function(a,b,c,d){a.situation=d.restoreLocal(),a.submit=function(){d.save(a.situation).then(function(){a.situation.infosComplementairesCaptured=!0,b.go("download_cerfa",{droit:c.droit})})}}]),angular.module("ddsApp").controller("FormInfosComplementairesSituationProCtrl",["$scope","$state","$stateParams","situationsPro","situation","SituationService",function(a,b,c,d,e,f){a.situation=e,a.situationsPro=d,a.individusRef=[{id:"demandeur",label:"Vous",individu:_.find(e.individus,{role:"demandeur"}),situationsPro:[]}];var g=_.find(e.individus,{role:"conjoint"});g&&a.individusRef.push({id:"conjoint",label:"Votre partenaire",individu:g,situationsPro:[]}),a.individusRef.forEach(function(b){a.situationsPro.forEach(function(a){var c=_.find(b.individu.situationsPro,{situation:a.id});c?(c.selected=!0,c.label=a.label,b.situationsPro.push(c)):b.situationsPro.push({situation:a.id,label:a.label,selected:!1})})}),a.submit=function(){a.individusRef.forEach(function(a){a.individu.situationsPro=_.filter(a.situationsPro,"selected")}),f.save(e).then(function(){e.infosComplementairesCaptured=!0,b.go("download_cerfa",{droit:c.droit})})}}]),angular.module("ddsApp").controller("DownloadCerfaCtrl",["$scope","$sce","cerfaForms","CerfaService","situation","droit",function(a,b,c,d,e,f){a.situation=e,a.cerfa=d.getCerfaFromDroit(f),a.cerfaForms=d.getCerfaFormsFromDroit(f,e),a.isSituationMonoIndividu=1===e.individus.length,a.piecesJustificatives=d.getRequiredPiecesJustificatives(a.cerfa,f,e),a.trustAsHtml=function(a){return b.trustAsHtml(a)}}]),angular.module("ddsApp").factory("SituationService",["$http","$sessionStorage","$modal",function(a,b,c){var d,e=function(a,b,c){if(a.periode)return void c.push(a);var d=moment(a.debutPeriode,"YYYY-MM"),e=moment(a.finPeriode,"YYYY-MM"),f=e.diff(d,"months")+1,g=a.montant;_.where(b,{type:a.type}).forEach(function(a){var b=a.periode;b&&(b=moment(b,"YYYY-MM"),(b.isAfter(d)||b.isSame(d))&&(b.isBefore(e)||b.isSame(e))&&(g-=a.montant,f--))});for(var h=Math.round(g/f*100)/100;d.isBefore(e)||d.isSame(e);){if(!_.find(b,{periode:d.format("YYYY-MM")})){var i={periode:d.format("YYYY-MM"),montant:h};a.type&&(i.type=a.type),c.push(i)}d.add(1,"months")}},f=function(a){var b=a.revenusDuCapital;a.revenusDuCapital=[],b.forEach(function(c){e(c,b,a.revenusDuCapital)}),b=a.revenusLocatifs,a.revenusLocatifs=[],b.forEach(function(c){e(c,b,a.revenusLocatifs)})};return{newSituation:function(){d=b.situation={individus:[],dateDeValeur:moment().format()}},restoreLocal:function(){return d||(d=b.situation),d||this.newSituation(),d.individus.forEach(function(a){a.dateDeNaissance=moment(a.dateDeNaissance)}),d},restoreRemote:function(c){return a.get("/api/situations/"+c).then(function(a){return d=a.data,d.individus.forEach(function(a){a.dateDeNaissance=moment(a.dateDeNaissance)}),b.situation=d,d})},getMonths:function(a){var b=a?moment(a):moment();return b.subtract(4,"months"),_.map([3,2,1],function(){return b.add(1,"months"),{id:b.format("YYYY-MM"),label:b.format("MMMM YYYY")}})},save:function(b){var d=this.createApiCompatibleSituation(b);return b._id?a.put("/api/situations/"+b._id,d).then(function(a){return a.data}):a.post("/api/situations",d).then(function(a){return b._id=a.data._id,a.data})["catch"](function(a){c.open({templateUrl:"/partials/error-modal.html",controller:["$scope",function(b){b.error=a}]})})},createApiCompatibleSituation:function(a){var b=_.map(a.individus,this.createApiCompatibleIndividu),c=_.find(b,{role:"conjoint"}),d=_.find(b,{role:"demandeur"});if(d.statutMarital=c?c.statutMarital:d.situationFamiliale,a.logement.dateArriveeString){var e=moment(a.logement.dateArriveeString,"L");e.isValid()&&(a.logement.dateArrivee=e.format("YYYY-MM-DD"))}a.patrimoine&&f(a.patrimoine);var g={individus:b,logement:a.logement,patrimoine:a.patrimoine,phoneNumber:a.phoneNumber,email:a.email};return a.ressourcesYearMoins2Captured&&(g.ressourcesYearMoins2Captured=!0,g.rfr=a.rfr),g},createApiCompatibleIndividu:function(a){var b=_.cloneDeep(a);if(b.dateDeNaissance=a.dateDeNaissance&&a.dateDeNaissance.format("YYYY-MM-DD"),a.dateArriveeFoyerString){var c=moment(a.dateArriveeFoyerString,"L");c.isValid()&&(b.dateArriveeFoyer=c.format("YYYY-MM-DD"))}if(a.dateSituationFamiliale){var d=moment(a.dateSituationFamiliale,"L");d.isValid()?b.dateSituationFamiliale=d.format("YYYY-MM-DD"):delete b.dateSituationFamiliale}return b},flattenPatrimoine:f,hasEnfantScolarise:function(a){return!!_.find(a.individus,{role:"enfant",scolarite:"college"})||!!_.find(a.individus,{role:"enfant",scolarite:"lycee"})}}}]),angular.module("ddsApp").service("SimulationService",["$http","droitsDescription",function(a,b){function c(a){return function(b){var c={};return _.forEach(b,function(b,d){a(b,d)&&(c[d]=b)}),c}}function d(a){return _.mapValues(a,function(a,c){var d=_.clone(b[c]);return d.montant=a,d})}var e=c(function(a,c){return b[c]}),f=c(function(a){return a});return{simulate:function(b){return a.get("/api/situations/"+b._id+"/simulation").then(function(a){return d(f(e(a.data)))})},filterUnhandled:e,filterIneligible:f,describe:d,complement:function(a){var c=_.clone(b);return _.forEach(a,function(a,b){delete c[b]}),c}}}]),angular.module("ddsCommon").service("IndividuService",["$filter","situationsPro","nationalites",function(a,b,c){var d=_.filter(b,"isStatutSpecifique");return{age:function(a){return moment().diff(a.dateDeNaissance,"years")},label:function(a){return"demandeur"===a.role?"Vous":"conjoint"===a.role?"Votre conjoint":a.firstName},nationaliteLabel:function(a){return _.find(c,{id:a.nationalite}).label},getStatutsSpecifiques:function(){return d},isRoleParent:function(a){return _.contains(["demandeur","conjoint"],a)},isParent:function(a){return this.isRoleParent(a.role)},getParents:function(a){var b=this;return _.filter(a,function(a){return b.isParent(a)})},formatStatutsSpecifiques:function(b){var c=[];return d.forEach(function(a){_.find(b.situationsPro,{situation:a.id})&&c.push(a.label)}),b.enceinte&&c.push("enceinte"),b.boursier&&c.push("boursier"),b.gardeAlternee&&c.push("en garde alternée"),c=_.map(c,a("lowercaseFirst")),c=c.join(", "),c=a("uppercaseFirst")(c)}}}]),angular.module("ddsApp").factory("CerfaService",["cerfaForms","piecesJustificatives","SituationService","IndividuService",function(a,b,c,d){var e={cmuc_choix_organisme_non_demandeur:function(a){return 1<a.individus.length},rsa_non_salarie:function(a){var b=_.find(a.individus,{role:"demandeur"}),c=_.find(b.situationsPro,{situation:"independant"});return!!c},rsa_moins_25:function(a){var b=25>d.age(_.find(a.individus,{role:"demandeur"})),c=_.find(a.individus,{role:"conjoint"});return c&&(b=b||25>d.age(c)),b},caf_attestation_pret:function(a){return"proprietaire"===a.logement.type},caf_attestation_loyer:function(a){return"locataire"===a.logement.type},caf_attestation_residence_foyer:function(){return!1}},f={identite:function(a){return"autre"!==a.nationalite&&18<=d.age(a)},ofii:function(a){return _.every([_.contains(["enfant","personneACharge"],a.role),18>d.age(a),"fr"!==a.nationalite,"France"!==a.paysNaissance])},titre_sejour:function(a){return"autre"!==a.nationalite?!1:_.contains(["enfant","personneACharge"],a.role)?18<=d.age(a):!0},imposition:function(a){return 16<=d.age(a)},declaration_grossesse:function(a){return!!_.filter(a.individus,"enceinte").length},attestation_chomage_partiel:function(a){var b=_.where(a.ressources,{type:"indChomagePartiel"}).length;return!!b},"cmu_c.vitale":function(a){return 18<=d.age(a)},"cmu_c.regularite":function(a){return"demandeur"!==a.role?"fr"!==a.nationalite:!1},"cmu_c.livret_famille":function(a){return!!_.where(a.individus,{role:"enfant"}).length||!!_.where(a.individus,{role:"personneACharge"}).length},"cmu_c.bulletins_paie":function(a){return 16>d.age(a)?!1:!!_.where(a.ressources,{type:"revenusSalarie"}).length},"cmu_c.attestation_indemnites_chomage":function(a){if(16>d.age(a))return!1;var b=_.where(a.ressources,{type:"allocationsChomage"}).length;return b+=_.where(a.ressources,{type:"indChomagePartiel"}).length,!!b},"cmu_c.taxe_fonciere":function(a){return"proprietaire"===a.logement.type},"cmu_c.taxe_habitation":function(a){return _.contains(["locataire","colocataire"],a.logement.type)},"rsa.identite":function(a){return d.isParent(a)?_.contains(["fr","ue"],a.nationalite):"France"===a.paysNaissance},"rsa.acte_naissance":function(a){return _.every([_.contains(["enfant","personneACharge"],a.role),18>d.age(a),"fr"!==a.nationalite,"France"===a.paysNaissance])},"rsa.avis_paiement_pension_invalidite":function(a){return d.isParent(a)?!!_.find(a.ressources,{type:"pensionsInvalidite"}):!1},"rsa.avis_paiement_retraite":function(a){return d.isParent(a)?!!_.find(a.situationsPro,{situation:"retraite"}):!1},"rsa.avis_paiement_rente_accident_travail":function(a){return d.isParent(a)?!!_.find(a.ressources,{type:"indJourAccidentDuTravail"}):!1},"rsa.declaration_revenus_saisonnier":function(a){return d.isParent(a)?!!_.find(a.situationsPro,{situation:"travailleur_saisonnier"}):!1},"rsa.taxe_habitation_patrimoine":function(a){return 0<a.patrimoine.valeurLocativeImmoNonLoue||0<a.patrimoine.valeurLocativeTerrainNonLoue},"aspa.imposition":function(a){return"demandeur"===a.role?!0:"conjoint"===a.role?"relation_libre"===a.statutMarital:!1},"aspa.titre_sejour":function(a){return d.isParent(a)?"autre"===a.nationalite:!1}},g=function(a){return"acs"===a?"cmu_c":a};return{getCerfaFromDroit:function(b){return _.find(a,{droitId:g(b)})},getCerfaFormsFromDroit:function(a,b){var c=this.getCerfaFromDroit(a),d=[];return c&&c.forms.forEach(function(a){var c=e[a.id];(!c||c(b))&&d.push(a)}),d},pieceJustificativeIndividus:function(a,b,c){var d=g(a);return _.filter(c,function(a){var c=f[d+"."+b];return c||(c=f[b]),c?c(a):!0})},isPieceJustificativeRequiredForSituation:function(a,b,c){var d=g(a),e=f[d+"."+b];return e||(e=f[b]),e?e(c):!0},getRequiredPiecesJustificatives:function(a,c,e){var f=[],g=this;return a.piecesJustificatives.forEach(function(a){var h=_.find(b,{id:a}),i={description:h};if(!1!==h.isIndividualized){var j=g.pieceJustificativeIndividus(c,h.id,e.individus);if(!j.length)return;i.individus=_.map(j,d.label)}else if(!g.isPieceJustificativeRequiredForSituation(c,h.id,e))return;f.push(i)}),f}}}]),angular.module("ddsApp").factory("RessourceService",function(){return{spreadIndividuRessources:function(a,b,c,d){var e=0;[2,1,0].forEach(function(d){var f=c.montantsMensuels[d];e+=f,a.ressources.push({type:c.type.id,periode:b[d].id,montant:f})});for(var f=(c.montantAnnuel-e)/9,g=0;9>g;g++){var h=moment(d).subtract(4+g,"months").format("YYYY-MM");a.ressources.push({type:c.type.id,periode:h,montant:f})}c.onGoing||a.interruptedRessources.push(c.type.id)}}}),angular.module("ddsApp").directive("ddsDate",function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.push(function(a){var b=moment(a,["DD/MM/YY","L","LL"]);return d.$setValidity("ddsDate",b.isValid()),b}),d.$formatters.push(function(a){return a?a.format("L"):void 0})}}}),angular.module("ddsApp").directive("ddsDateMonthYear",function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.push(function(a){var b=moment(a,["MM/YY","MM/YYYY","MMMM YYYY","L","DD/MM/YY"]);return d.$setValidity("ddsDateMonthYear",b.isValid()),b}),d.$formatters.push(function(a){return a?a.format("MM/YYYY"):void 0})}}}),angular.module("ddsApp").directive("selectOnFocus",function(){return{restrict:"A",link:function(a,b){b.on("click",function(){this.select()})}}}),angular.module("ddsApp").directive("zeroToEmpty",function(){return{require:"ngModel",link:function(a,b,c,d){b.on("focus",function(){"0"===d.$viewValue&&(d.$setViewValue(null),d.$render())}),b.on("blur",function(){null===d.$viewValue&&(d.$setViewValue("0"),d.$render())})}}}),angular.module("ddsApp").config(["$provide",function(a){a.decorator("$modal",["$delegate","$rootScope",function(a,b){return{open:function(c){b.$broadcast("modalOpenStart");var d=a.open(c);return d.opened["finally"](function(){b.$broadcast("modalOpenEnd")}),d}}}])}]),angular.module("ddsApp").directive("loadingSpinner",["$timeout",function(a){return{restrict:"E",template:'<div class="loading-spinner" ng-show="loading"><div class="loading-spinner-icon"></div></div>',link:function(b){b.loading=!1;var c=0,d=!1,e=function(){c++,a(function(){c>0&&(b.loading=!0)},100)};b.$on("$stateChangeStart",function(){d||(d=!0,e())}),b.$on("modalOpenStart",e);var f=function(){c--,0===c&&(b.loading=!1)};b.$on("$stateChangeSuccess",function(){d=!1,f()}),b.$on("$stateChangeError",function(){d=!1,f()}),b.$on("modalOpenEnd",f)}}}]),angular.module("ddsApp").directive("dateAutocomplete",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e="";d.$parsers.unshift(function(a){var b=e;e=a;var c=a.lastIndexOf("//");if(-1!==c&&c===a.length-2){var f=a.substring(0,a.length-1);return d.$setViewValue(f),d.$render(),f}return _.contains([2,5],a.length)?a.length!==b.length+1?a:b.lastIndexOf("/")===b.length-1?a:a.lastIndexOf("/")===a.length-1?a:(d.$setViewValue(a+"/"),d.$render(),a+"/"):a})}}}),angular.module("ddsApp").directive("dateNaissanceMaxAge",function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.push(function(b){var e=a.$eval(c.dateNaissanceMaxAge),f=moment().diff(b,"years");return d.$setValidity("dateNaissanceMaxAge",e>=f),b})}}}),angular.module("ddsApp").directive("dateNaissanceMinAge",function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.push(function(b){var e=a.$eval(c.dateNaissanceMinAge),f=moment().diff(b,"years");return d.$setValidity("dateNaissanceMinAge",f>=e),b})}}}),angular.module("ddsApp").directive("individuBlock",["IndividuService",function(a){return{restrict:"E",templateUrl:"partials/individu-block.html",scope:{individu:"="},controller:["$scope",function(b){b.individuLabel=a.label,b.nationalite=a.nationaliteLabel;var c=function(a){switch(a.role){case"demandeur":return"foyer.demandeur";case"conjoint":return"foyer.conjoint";default:return"foyer.personnesACharge"}};b.sref=c(b.individu)}]}}]),angular.module("ddsApp").directive("autoFocus",["$timeout",function(a){return{restrict:"AC",link:function(b,c){a(function(){c[0].focus()},0)}}}]),angular.module("ddsApp").directive("montantRessource",["SituationService",function(a){return{restrict:"E",require:"ngModel",replace:!0,templateUrl:"partials/foyer/capture-montant-ressource.html",scope:{shortLabel:"=",ressourceType:"=",dateDeValeur:"=",index:"=",onGoingLabel:"=?"},link:function(b,c,d,e){var f=moment(b.dateDeValeur).subtract("years",1),g=moment(b.dateDeValeur).startOf("month").subtract("months",1);
b.debutAnnee=f.format("MMMM YYYY"),b.finAnnee=g.format("MMMM YYYY"),b.months=a.getMonths(b.dateDeValeur),b.currentMonth=moment(b.dateDeValeur).format("MMMM YYYY"),b.onGoingLabel||(b.onGoingLabel="Je continuerai à percevoir cette ressource en "+b.currentMonth),e.$render=function(){b.ressource=e.$viewValue},b.updateMontantAnnuel=function(a){var b=a.montantsMensuels[0]+a.montantsMensuels[1]+a.montantsMensuels[2];_.isNaN(b)||(a.montantAnnuel=Math.round(4*b))}}}}]),angular.module("ddsCommon").filter("uppercaseFirst",function(){return function(a){return a.charAt(0).toUpperCase()+a.substring(1)}}).filter("lowercaseFirst",function(){return function(a){return a.charAt(0).toLowerCase()+a.substring(1)}});